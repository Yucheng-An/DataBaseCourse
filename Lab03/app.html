<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>APP</title>
</head>
<body>
<h1>IndexedDB Object Generator</h1>
<script>
  function getCurrentTimestamp() {
    return new Date().toISOString();
  }
  function generateRandomID() {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    return Array.from({ length: 6 }, () => chars[Math.floor(Math.random() * chars.length)]).join('');
  }
  function generateRandomLocation() {
    const latitude = (Math.random() * 180 - 90).toFixed(6);
    const longitude = (Math.random() * 360 - 180).toFixed(6);
    return { latitude, longitude };
  }
  function generateRandomStatus() {
    const statuses = ['working', 'maintenance', 'error'];
    return statuses[Math.floor(Math.random() * statuses.length)];
  }
  function generateObject() {
    return {
      uuid: crypto.randomUUID(),
      sourceDB: "IndexedDB",
      createdTime: getCurrentTimestamp(),
      updatedTime: getCurrentTimestamp(),
      sensorID: generateRandomID(),
      sensorLocation: generateRandomLocation(),
      sensorStatus: generateRandomStatus()
    };
  }

  let req = indexedDB.open("IndexDB", 1);

  req.onupgradeneeded = function(event) {
    let db = event.target.result;
    let objectStore = db.createObjectStore("Sensor", { keyPath: "id", autoIncrement: true });
  };

  req.onsuccess = function(event) {
    let db = event.target.result;
    let transaction = db.transaction("Sensor", "readonly");
    let objectStore = transaction.objectStore("Sensor");

    // Check if data already exists in the store
    let countRequest = objectStore.count();
    countRequest.onsuccess = function() {
      if (countRequest.result === 0) {
        // If no data, generate and add 1000 objects
        addData(db);
      } else {
        console.log(`Database already contains ${countRequest.result} records, no new data generated.`);
      }
    };
    countRequest.onerror = function() {
      console.error('Failed to count records in store');
    };
  };

  req.onerror = function(event) {
    console.error('Error opening IndexedDB:', event.target.errorCode);
  };

  function addData(db) {
    let transaction = db.transaction("Sensor", "readwrite");
    let objectStore = transaction.objectStore("Sensor");

    for (let i = 0; i < 1000; i++) {
      let request = objectStore.add(generateObject());
      request.onerror = function() {
        console.error('Failed to add object to store');
      };
      request.onsuccess = function() {
        console.log('Object added successfully');
      };
    }
  }
</script>
</body>
</html>
